<!DOCTYPE html>

<html>
<head>
  <title>backbone.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>backbone.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <pre><code>Backbone.tv 0.1
Forked from Backbone.js 1.0.0

(c) 2010-2013 Jeremy Ashkenas, DocumentCloud Inc.
Backbone may be freely distributed under the MIT license.
For all details and documentation:
http://backbonejs.org</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="keyword">function</span>(){</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2>Initial Setup</h2>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Save a reference to the global object (<code>window</code> in the browser, <code>exports</code>
on the server).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> root = <span class="keyword">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Save the previous value of the <code>Backbone</code> variable, so that it can be
restored later on, if <code>noConflict</code> is used.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> previousBackbone = root.Backbone;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Create local references to array methods we&#39;ll want to use later.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> array = [];
  <span class="keyword">var</span> push = array.push;
  <span class="keyword">var</span> slice = array.slice;
  <span class="keyword">var</span> splice = array.splice;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>The top-level namespace. All public Backbone classes and modules will
be attached to this. Exported for both the browser and the server.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> Backbone;
  <span class="keyword">if</span> (<span class="keyword">typeof</span> exports !== <span class="string">'undefined'</span>) {
    Backbone = exports;
  } <span class="keyword">else</span> {
    Backbone = root.Backbone = {};
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Current version of the library. Keep in sync with <code>package.json</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Backbone.VERSION = <span class="string">'0.1'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Require Underscore, if we&#39;re on the server, and it&#39;s not already present.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> _ = root._;
  <span class="keyword">if</span> (!_ &amp;&amp; (<span class="keyword">typeof</span> require !== <span class="string">'undefined'</span>)) _ = require(<span class="string">'underscore'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>For Backbone&#39;s purposes, jQuery, Zepto, Ender, or My Library (kidding) owns
the <code>$</code> variable.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Backbone.$ = root.jQuery || root.Zepto || root.ender || root.$;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Runs Backbone.js in <em>noConflict</em> mode, returning the <code>Backbone</code> variable
to its previous owner. Returns a reference to this Backbone object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Backbone.noConflict = <span class="keyword">function</span>() {
    root.Backbone = previousBackbone;
    <span class="keyword">return</span> <span class="keyword">this</span>;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h2>Backbone.Events</h2>

            </div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>A module that can be mixed in to <em>any object</em> in order to provide it with
custom events. You may bind with <code>on</code> or remove with <code>off</code> callback
functions to an event; <code>trigger</code>-ing an event fires all callbacks in
succession.</p>
<pre><code>var object = {};
_.extend(object, Backbone.Events);
object.on(&#39;expand&#39;, function(){ alert(&#39;expanded&#39;); });
object.trigger(&#39;expand&#39;);</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> Events = Backbone.Events = {</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Bind an event to a <code>callback</code> function. Passing <code>&quot;all&quot;</code> will bind
the callback to all events fired.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    on: <span class="keyword">function</span>(name, callback, context) {
      <span class="keyword">if</span> (!eventsApi(<span class="keyword">this</span>, <span class="string">'on'</span>, name, [callback, context]) || !callback) <span class="keyword">return</span> <span class="keyword">this</span>;
      <span class="keyword">this</span>._events || (<span class="keyword">this</span>._events = {});
      <span class="keyword">var</span> events = <span class="keyword">this</span>._events[name] || (<span class="keyword">this</span>._events[name] = []);
      events.push({callback: callback, context: context, ctx: context || <span class="keyword">this</span>});
      <span class="keyword">return</span> <span class="keyword">this</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Bind an event to only be triggered a single time. After the first time
the callback is invoked, it will be removed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    once: <span class="keyword">function</span>(name, callback, context) {
      <span class="keyword">if</span> (!eventsApi(<span class="keyword">this</span>, <span class="string">'once'</span>, name, [callback, context]) || !callback) <span class="keyword">return</span> <span class="keyword">this</span>;
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
      <span class="keyword">var</span> once = _.once(<span class="keyword">function</span>() {
        self.off(name, once);
        callback.apply(<span class="keyword">this</span>, arguments);
      });
      once._callback = callback;
      <span class="keyword">return</span> <span class="keyword">this</span>.on(name, once, context);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Remove one or many callbacks. If <code>context</code> is null, removes all
callbacks with that function. If <code>callback</code> is null, removes all
callbacks for the event. If <code>name</code> is null, removes all bound
callbacks for all events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    off: <span class="keyword">function</span>(name, callback, context) {
      <span class="keyword">var</span> retain, ev, events, names, i, l, j, k;
      <span class="keyword">if</span> (!<span class="keyword">this</span>._events || !eventsApi(<span class="keyword">this</span>, <span class="string">'off'</span>, name, [callback, context])) <span class="keyword">return</span> <span class="keyword">this</span>;
      <span class="keyword">if</span> (!name &amp;&amp; !callback &amp;&amp; !context) {
        <span class="keyword">this</span>._events = {};
        <span class="keyword">return</span> <span class="keyword">this</span>;
      }

      names = name ? [name] : _.keys(<span class="keyword">this</span>._events);
      <span class="keyword">for</span> (i = <span class="number">0</span>, l = names.length; i &lt; l; i++) {
        name = names[i];
        <span class="keyword">if</span> (events = <span class="keyword">this</span>._events[name]) {
          <span class="keyword">this</span>._events[name] = retain = [];
          <span class="keyword">if</span> (callback || context) {
            <span class="keyword">for</span> (j = <span class="number">0</span>, k = events.length; j &lt; k; j++) {
              ev = events[j];
              <span class="keyword">if</span> ((callback &amp;&amp; callback !== ev.callback &amp;&amp; callback !== ev.callback._callback) ||
                  (context &amp;&amp; context !== ev.context)) {
                retain.push(ev);
              }
            }
          }
          <span class="keyword">if</span> (!retain.length) <span class="keyword">delete</span> <span class="keyword">this</span>._events[name];
        }
      }

      <span class="keyword">return</span> <span class="keyword">this</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Trigger one or many events, firing all bound callbacks. Callbacks are
passed the same arguments as <code>trigger</code> is, apart from the event name
(unless you&#39;re listening on <code>&quot;all&quot;</code>, which will cause your callback to
receive the true name of the event as the first argument).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    trigger: <span class="keyword">function</span>(name) {
      <span class="keyword">if</span> (!<span class="keyword">this</span>._events) <span class="keyword">return</span> <span class="keyword">this</span>;
      <span class="keyword">var</span> args = slice.call(arguments, <span class="number">1</span>);
      <span class="keyword">if</span> (!eventsApi(<span class="keyword">this</span>, <span class="string">'trigger'</span>, name, args)) <span class="keyword">return</span> <span class="keyword">this</span>;
      <span class="keyword">var</span> events = <span class="keyword">this</span>._events[name];
      <span class="keyword">var</span> allEvents = <span class="keyword">this</span>._events.all;
      <span class="keyword">if</span> (events) triggerEvents(events, args);
      <span class="keyword">if</span> (allEvents) triggerEvents(allEvents, arguments);
      <span class="keyword">return</span> <span class="keyword">this</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Tell this object to stop listening to either specific events ... or
to every object it&#39;s currently listening to.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    stopListening: <span class="keyword">function</span>(obj, name, callback) {
      <span class="keyword">var</span> listeners = <span class="keyword">this</span>._listeners;
      <span class="keyword">if</span> (!listeners) <span class="keyword">return</span> <span class="keyword">this</span>;
      <span class="keyword">var</span> deleteListener = !name &amp;&amp; !callback;
      <span class="keyword">if</span> (<span class="keyword">typeof</span> name === <span class="string">'object'</span>) callback = <span class="keyword">this</span>;
      <span class="keyword">if</span> (obj) (listeners = {})[obj._listenerId] = obj;
      <span class="keyword">for</span> (<span class="keyword">var</span> id <span class="keyword">in</span> listeners) {
        listeners[id].off(name, callback, <span class="keyword">this</span>);
        <span class="keyword">if</span> (deleteListener) <span class="keyword">delete</span> <span class="keyword">this</span>._listeners[id];
      }
      <span class="keyword">return</span> <span class="keyword">this</span>;
    }

  };</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Regular expression used to split event strings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> eventSplitter = <span class="regexp">/\s+/</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Implement fancy features of the Events API such as multiple event
names <code>&quot;change blur&quot;</code> and jQuery-style event maps <code>{change: action}</code>
in terms of the existing API.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> eventsApi = <span class="keyword">function</span>(obj, action, name, rest) {
    <span class="keyword">if</span> (!name) <span class="keyword">return</span> <span class="literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Handle event maps.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (<span class="keyword">typeof</span> name === <span class="string">'object'</span>) {
      <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> name) {
        obj[action].apply(obj, [key, name[key]].concat(rest));
      }
      <span class="keyword">return</span> <span class="literal">false</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Handle space separated event names.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (eventSplitter.test(name)) {
      <span class="keyword">var</span> names = name.split(eventSplitter);
      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = names.length; i &lt; l; i++) {
        obj[action].apply(obj, [names[i]].concat(rest));
      }
      <span class="keyword">return</span> <span class="literal">false</span>;
    }

    <span class="keyword">return</span> <span class="literal">true</span>;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>A difficult-to-believe, but optimized internal dispatch function for
triggering events. Tries to keep the usual cases speedy (most internal
Backbone events have 3 arguments).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> triggerEvents = <span class="keyword">function</span>(events, args) {
    <span class="keyword">var</span> ev, i = -<span class="number">1</span>, l = events.length, a1 = args[<span class="number">0</span>], a2 = args[<span class="number">1</span>], a3 = args[<span class="number">2</span>];
    <span class="keyword">switch</span> (args.length) {
      <span class="keyword">case</span> <span class="number">0</span>: <span class="keyword">while</span> (++i &lt; l) (ev = events[i]).callback.call(ev.ctx); <span class="keyword">return</span>;
      <span class="keyword">case</span> <span class="number">1</span>: <span class="keyword">while</span> (++i &lt; l) (ev = events[i]).callback.call(ev.ctx, a1); <span class="keyword">return</span>;
      <span class="keyword">case</span> <span class="number">2</span>: <span class="keyword">while</span> (++i &lt; l) (ev = events[i]).callback.call(ev.ctx, a1, a2); <span class="keyword">return</span>;
      <span class="keyword">case</span> <span class="number">3</span>: <span class="keyword">while</span> (++i &lt; l) (ev = events[i]).callback.call(ev.ctx, a1, a2, a3); <span class="keyword">return</span>;
      <span class="keyword">default</span>: <span class="keyword">while</span> (++i &lt; l) (ev = events[i]).callback.apply(ev.ctx, args);
    }
  };

  <span class="keyword">var</span> listenMethods = {listenTo: <span class="string">'on'</span>, listenToOnce: <span class="string">'once'</span>};</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Inversion-of-control versions of <code>on</code> and <code>once</code>. Tell <em>this</em> object to
listen to an event in another object ... keeping track of what it&#39;s
listening to.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.each(listenMethods, <span class="keyword">function</span>(implementation, method) {
    Events[method] = <span class="keyword">function</span>(obj, name, callback) {
      <span class="keyword">var</span> listeners = <span class="keyword">this</span>._listeners || (<span class="keyword">this</span>._listeners = {});
      <span class="keyword">var</span> id = obj._listenerId || (obj._listenerId = _.uniqueId(<span class="string">'l'</span>));
      listeners[id] = obj;
      <span class="keyword">if</span> (<span class="keyword">typeof</span> name === <span class="string">'object'</span>) callback = <span class="keyword">this</span>;
      obj[implementation](name, callback, <span class="keyword">this</span>);
      <span class="keyword">return</span> <span class="keyword">this</span>;
    };
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Aliases for backwards compatibility.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Events.bind   = Events.on;
  Events.unbind = Events.off;</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Allow the <code>Backbone</code> object to serve as a global event bus, for folks who
want global &quot;pubsub&quot; in a convenient place.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.extend(Backbone, Events);</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h2>Backbone.Model</h2>

            </div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Backbone <strong>Models</strong> are the basic data object in the framework --
frequently representing a row in a table in a database on your server.
A discrete chunk of data and a bunch of useful, related methods for
performing computations and transformations on that data.</p>
<p>Create a new model with the specified attributes. A client id (<code>cid</code>)
is automatically generated and assigned for you.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> Model = Backbone.Model = <span class="keyword">function</span>(attributes, options) {
    <span class="keyword">var</span> defaults;
    <span class="keyword">var</span> attrs = attributes || {};
    options || (options = {});
    <span class="keyword">this</span>.cid = _.uniqueId(<span class="string">'c'</span>);
    <span class="keyword">this</span>.attributes = {};
    <span class="keyword">if</span> (options.collection) <span class="keyword">this</span>.collection = options.collection;
    <span class="keyword">if</span> (options.parse) attrs = <span class="keyword">this</span>.parse(attrs, options) || {};
    <span class="keyword">if</span> (defaults = _.result(<span class="keyword">this</span>, <span class="string">'defaults'</span>)) {
      attrs = _.defaults({}, attrs, defaults);
    }
    <span class="keyword">this</span>.set(attrs, options);
    <span class="keyword">this</span>.changed = {};
    <span class="keyword">this</span>.initialize.apply(<span class="keyword">this</span>, arguments);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Attach all inheritable methods to the Model prototype.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.extend(Model.prototype, Events, {</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>A hash of attributes whose current and previous value differ.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    changed: <span class="literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>The value returned during the last failed validation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    validationError: <span class="literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>The default name for the JSON <code>id</code> attribute is <code>&quot;id&quot;</code>. MongoDB and
CouchDB users may want to set this to <code>&quot;_id&quot;</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    idAttribute: <span class="string">'id'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Initialize is an empty function by default. Override it with your own
initialization logic.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    initialize: <span class="keyword">function</span>(){},</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Return a copy of the model&#39;s <code>attributes</code> object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toJSON: <span class="keyword">function</span>(options) {
      <span class="keyword">return</span> _.clone(<span class="keyword">this</span>.attributes);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Get the value of an attribute.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    get: <span class="keyword">function</span>(attr) {
      <span class="keyword">return</span> <span class="keyword">this</span>.attributes[attr];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Get the HTML-escaped value of an attribute.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    escape: <span class="keyword">function</span>(attr) {
      <span class="keyword">return</span> _.escape(<span class="keyword">this</span>.get(attr));
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Returns <code>true</code> if the attribute contains a value that is not null
or undefined.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    has: <span class="keyword">function</span>(attr) {
      <span class="keyword">return</span> <span class="keyword">this</span>.get(attr) != <span class="literal">null</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Set a hash of model attributes on the object, firing <code>&quot;change&quot;</code>. This is
the core primitive operation of a model, updating the data and notifying
anyone who needs to know about the change in state. The heart of the beast.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    set: <span class="keyword">function</span>(key, val, options) {
      <span class="keyword">var</span> attr, attrs, unset, changes, silent, changing, prev, current;
      <span class="keyword">if</span> (key == <span class="literal">null</span>) <span class="keyword">return</span> <span class="keyword">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Handle both <code>&quot;key&quot;, value</code> and <code>{key: value}</code> -style arguments.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (<span class="keyword">typeof</span> key === <span class="string">'object'</span>) {
        attrs = key;
        options = val;
      } <span class="keyword">else</span> {
        (attrs = {})[key] = val;
      }

      options || (options = {});</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Run validation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (!<span class="keyword">this</span>._validate(attrs, options)) <span class="keyword">return</span> <span class="literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Extract attributes and options.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      unset           = options.unset;
      silent          = options.silent;
      changes         = [];
      changing        = <span class="keyword">this</span>._changing;
      <span class="keyword">this</span>._changing  = <span class="literal">true</span>;

      <span class="keyword">if</span> (!changing) {
        <span class="keyword">this</span>._previousAttributes = _.clone(<span class="keyword">this</span>.attributes);
        <span class="keyword">this</span>.changed = {};
      }
      current = <span class="keyword">this</span>.attributes, prev = <span class="keyword">this</span>._previousAttributes;</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Check for changes of <code>id</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (<span class="keyword">this</span>.idAttribute <span class="keyword">in</span> attrs) <span class="keyword">this</span>.id = attrs[<span class="keyword">this</span>.idAttribute];</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>For each <code>set</code> attribute, update or delete the current value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">for</span> (attr <span class="keyword">in</span> attrs) {
        val = attrs[attr];
        <span class="keyword">if</span> (!_.isEqual(current[attr], val)) changes.push(attr);
        <span class="keyword">if</span> (!_.isEqual(prev[attr], val)) {
          <span class="keyword">this</span>.changed[attr] = val;
        } <span class="keyword">else</span> {
          <span class="keyword">delete</span> <span class="keyword">this</span>.changed[attr];
        }
        unset ? <span class="keyword">delete</span> current[attr] : current[attr] = val;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Trigger all relevant attribute changes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (!silent) {
        <span class="keyword">if</span> (changes.length) <span class="keyword">this</span>._pending = <span class="literal">true</span>;
        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = changes.length; i &lt; l; i++) {
          <span class="keyword">this</span>.trigger(<span class="string">'change:'</span> + changes[i], <span class="keyword">this</span>, current[changes[i]], options);
        }
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>You might be wondering why there&#39;s a <code>while</code> loop here. Changes can
be recursively nested within <code>&quot;change&quot;</code> events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (changing) <span class="keyword">return</span> <span class="keyword">this</span>;
      <span class="keyword">if</span> (!silent) {
        <span class="keyword">while</span> (<span class="keyword">this</span>._pending) {
          <span class="keyword">this</span>._pending = <span class="literal">false</span>;
          <span class="keyword">this</span>.trigger(<span class="string">'change'</span>, <span class="keyword">this</span>, options);
        }
      }
      <span class="keyword">this</span>._pending = <span class="literal">false</span>;
      <span class="keyword">this</span>._changing = <span class="literal">false</span>;
      <span class="keyword">return</span> <span class="keyword">this</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Remove an attribute from the model, firing <code>&quot;change&quot;</code>. <code>unset</code> is a noop
if the attribute doesn&#39;t exist.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    unset: <span class="keyword">function</span>(attr, options) {
      <span class="keyword">return</span> <span class="keyword">this</span>.set(attr, <span class="keyword">void</span> <span class="number">0</span>, _.extend({}, options, {unset: <span class="literal">true</span>}));
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Clear all attributes on the model, firing <code>&quot;change&quot;</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    clear: <span class="keyword">function</span>(options) {
      <span class="keyword">var</span> attrs = {};
      <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> <span class="keyword">this</span>.attributes) attrs[key] = <span class="keyword">void</span> <span class="number">0</span>;
      <span class="keyword">return</span> <span class="keyword">this</span>.set(attrs, _.extend({}, options, {unset: <span class="literal">true</span>}));
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Determine if the model has changed since the last <code>&quot;change&quot;</code> event.
If you specify an attribute name, determine if that attribute has changed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    hasChanged: <span class="keyword">function</span>(attr) {
      <span class="keyword">if</span> (attr == <span class="literal">null</span>) <span class="keyword">return</span> !_.isEmpty(<span class="keyword">this</span>.changed);
      <span class="keyword">return</span> _.has(<span class="keyword">this</span>.changed, attr);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Return an object containing all the attributes that have changed, or
false if there are no changed attributes. Useful for determining what
parts of a view need to be updated and/or what attributes need to be
persisted to the server. Unset attributes will be set to undefined.
You can also pass an attributes object to diff against the model,
determining if there <em>would be</em> a change.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    changedAttributes: <span class="keyword">function</span>(diff) {
      <span class="keyword">if</span> (!diff) <span class="keyword">return</span> <span class="keyword">this</span>.hasChanged() ? _.clone(<span class="keyword">this</span>.changed) : <span class="literal">false</span>;
      <span class="keyword">var</span> val, changed = <span class="literal">false</span>;
      <span class="keyword">var</span> old = <span class="keyword">this</span>._changing ? <span class="keyword">this</span>._previousAttributes : <span class="keyword">this</span>.attributes;
      <span class="keyword">for</span> (<span class="keyword">var</span> attr <span class="keyword">in</span> diff) {
        <span class="keyword">if</span> (_.isEqual(old[attr], (val = diff[attr]))) <span class="keyword">continue</span>;
        (changed || (changed = {}))[attr] = val;
      }
      <span class="keyword">return</span> changed;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Get the previous value of an attribute, recorded at the time the last
<code>&quot;change&quot;</code> event was fired.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    previous: <span class="keyword">function</span>(attr) {
      <span class="keyword">if</span> (attr == <span class="literal">null</span> || !<span class="keyword">this</span>._previousAttributes) <span class="keyword">return</span> <span class="literal">null</span>;
      <span class="keyword">return</span> <span class="keyword">this</span>._previousAttributes[attr];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Get all of the attributes of the model at the time of the previous
<code>&quot;change&quot;</code> event.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    previousAttributes: <span class="keyword">function</span>() {
      <span class="keyword">return</span> _.clone(<span class="keyword">this</span>._previousAttributes);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p><strong>parse</strong> converts a response into the hash of attributes to be <code>set</code> on
the model. The default implementation is just to pass the response along.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    parse: <span class="keyword">function</span>(resp, options) {
      <span class="keyword">return</span> resp;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Create a new model with identical attributes to this one.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    clone: <span class="keyword">function</span>() {
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">this</span>.constructor(<span class="keyword">this</span>.attributes);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>A model is new if it has never been saved to the server, and lacks an id.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    isNew: <span class="keyword">function</span>() {
      <span class="keyword">return</span> <span class="keyword">this</span>.id == <span class="literal">null</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Check if the model is currently in a valid state.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    isValid: <span class="keyword">function</span>(options) {
      <span class="keyword">return</span> <span class="keyword">this</span>._validate({}, _.extend(options || {}, { validate: <span class="literal">true</span> }));
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Run validation against the next complete set of model attributes,
returning <code>true</code> if all is well. Otherwise, fire an <code>&quot;invalid&quot;</code> event.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _validate: <span class="keyword">function</span>(attrs, options) {
      <span class="keyword">if</span> (!options.validate || !<span class="keyword">this</span>.validate) <span class="keyword">return</span> <span class="literal">true</span>;
      attrs = _.extend({}, <span class="keyword">this</span>.attributes, attrs);
      <span class="keyword">var</span> error = <span class="keyword">this</span>.validationError = <span class="keyword">this</span>.validate(attrs, options) || <span class="literal">null</span>;
      <span class="keyword">if</span> (!error) <span class="keyword">return</span> <span class="literal">true</span>;
      <span class="keyword">this</span>.trigger(<span class="string">'invalid'</span>, <span class="keyword">this</span>, error, _.extend(options || {}, {validationError: error}));
      <span class="keyword">return</span> <span class="literal">false</span>;
    }

  });</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Underscore methods that we want to implement on the Model.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> modelMethods = [<span class="string">'keys'</span>, <span class="string">'values'</span>, <span class="string">'pairs'</span>, <span class="string">'invert'</span>, <span class="string">'pick'</span>, <span class="string">'omit'</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Mix in each Underscore method as a proxy to <code>Model#attributes</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.each(modelMethods, <span class="keyword">function</span>(method) {
    Model.prototype[method] = <span class="keyword">function</span>() {
      <span class="keyword">var</span> args = slice.call(arguments);
      args.unshift(<span class="keyword">this</span>.attributes);
      <span class="keyword">return</span> _[method].apply(_, args);
    };
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <h2>Backbone.Collection</h2>

            </div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>If models tend to represent a single row of data, a Backbone Collection is
more analagous to a table full of data ... or a small slice or page of that
table, or a collection of rows that belong together for a particular reason
-- all of the messages in this particular folder, all of the documents
belonging to this particular author, and so on. Collections maintain
indexes of their models, both in order, and for lookup by <code>id</code>.</p>
<p>Create a new <strong>Collection</strong>, perhaps to contain a specific type of <code>model</code>.
If a <code>comparator</code> is specified, the Collection will maintain
its models in sort order, as they&#39;re added and removed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> Collection = Backbone.Collection = <span class="keyword">function</span>(models, options) {
    options || (options = {});
    <span class="keyword">if</span> (options.model) <span class="keyword">this</span>.model = options.model;
    <span class="keyword">if</span> (options.comparator !== <span class="keyword">void</span> <span class="number">0</span>) <span class="keyword">this</span>.comparator = options.comparator;
    <span class="keyword">this</span>._reset();
    <span class="keyword">this</span>.initialize.apply(<span class="keyword">this</span>, arguments);
    <span class="keyword">if</span> (models) <span class="keyword">this</span>.reset(models, _.extend({silent: <span class="literal">true</span>}, options));
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Default options for <code>Collection#set</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> setOptions = {add: <span class="literal">true</span>, remove: <span class="literal">true</span>, merge: <span class="literal">true</span>};
  <span class="keyword">var</span> addOptions = {add: <span class="literal">true</span>, merge: <span class="literal">false</span>, remove: <span class="literal">false</span>};</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Define the Collection&#39;s inheritable methods.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.extend(Collection.prototype, Events, {</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>The default model for a collection is just a <strong>Backbone.Model</strong>.
This should be overridden in most cases.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    model: Model,</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Initialize is an empty function by default. Override it with your own
initialization logic.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    initialize: <span class="keyword">function</span>(){},</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>The JSON representation of a Collection is an array of the
models&#39; attributes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toJSON: <span class="keyword">function</span>(options) {
      <span class="keyword">return</span> <span class="keyword">this</span>.map(<span class="keyword">function</span>(model){ <span class="keyword">return</span> model.toJSON(options); });
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Add a model, or list of models to the set.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    add: <span class="keyword">function</span>(models, options) {
      <span class="keyword">return</span> <span class="keyword">this</span>.set(models, _.defaults(options || {}, addOptions));
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p><strong>parse</strong> converts a response into a list of models to be added to the
collection. The default implementation is just to pass it through.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    parse: <span class="keyword">function</span>(resp, options) {
      <span class="keyword">return</span> resp;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Remove a model, or a list of models from the set.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    remove: <span class="keyword">function</span>(models, options) {
      models = _.isArray(models) ? models.slice() : [models];
      options || (options = {});
      <span class="keyword">var</span> i, l, index, model;
      <span class="keyword">for</span> (i = <span class="number">0</span>, l = models.length; i &lt; l; i++) {
        model = <span class="keyword">this</span>.get(models[i]);
        <span class="keyword">if</span> (!model) <span class="keyword">continue</span>;
        <span class="keyword">delete</span> <span class="keyword">this</span>._byId[model.id];
        <span class="keyword">delete</span> <span class="keyword">this</span>._byId[model.cid];
        index = <span class="keyword">this</span>.indexOf(model);
        <span class="keyword">this</span>.models.splice(index, <span class="number">1</span>);
        <span class="keyword">this</span>.length--;
        <span class="keyword">if</span> (!options.silent) {
          options.index = index;
          model.trigger(<span class="string">'remove'</span>, model, <span class="keyword">this</span>, options);
        }
        <span class="keyword">this</span>._removeReference(model);
      }
      <span class="keyword">return</span> <span class="keyword">this</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Update a collection by <code>set</code>-ing a new list of models, adding new ones,
removing models that are no longer present, and merging models that
already exist in the collection, as necessary. Similar to <strong>Model#set</strong>,
the core operation for updating the data contained by the collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    set: <span class="keyword">function</span>(models, options) {
      options = _.defaults(options || {}, setOptions);
      <span class="keyword">if</span> (options.parse) models = <span class="keyword">this</span>.parse(models, options);
      <span class="keyword">if</span> (!_.isArray(models)) models = models ? [models] : [];
      <span class="keyword">var</span> i, l, model, attrs, existing, sort;
      <span class="keyword">var</span> at = options.at;
      <span class="keyword">var</span> sortable = <span class="keyword">this</span>.comparator &amp;&amp; (at == <span class="literal">null</span>) &amp;&amp; options.sort !== <span class="literal">false</span>;
      <span class="keyword">var</span> sortAttr = _.isString(<span class="keyword">this</span>.comparator) ? <span class="keyword">this</span>.comparator : <span class="literal">null</span>;
      <span class="keyword">var</span> toAdd = [], toRemove = [], modelMap = {};
      <span class="keyword">var</span> add = options.add, merge = options.merge, remove = options.remove;
      <span class="keyword">var</span> order = !sortable &amp;&amp; add &amp;&amp; remove ? [] : <span class="literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>Turn bare objects into model references, and prevent invalid models
from being added.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">for</span> (i = <span class="number">0</span>, l = models.length; i &lt; l; i++) {
        <span class="keyword">if</span> (!(model = <span class="keyword">this</span>._prepareModel(models[i], options))) <span class="keyword">continue</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>If a duplicate is found, prevent it from being added and
optionally merge it into the existing model.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> (existing = <span class="keyword">this</span>.get(model)) {
          <span class="keyword">if</span> (remove) modelMap[existing.cid] = <span class="literal">true</span>;
          <span class="keyword">if</span> (merge) {
            existing.set(model.attributes, options);
            <span class="keyword">if</span> (sortable &amp;&amp; !sort &amp;&amp; existing.hasChanged(sortAttr)) sort = <span class="literal">true</span>;
          }</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>This is a new model, push it to the <code>toAdd</code> list.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        } <span class="keyword">else</span> <span class="keyword">if</span> (add) {
          toAdd.push(model);</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>Listen to added models&#39; events, and index models for lookup by
<code>id</code> and by <code>cid</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          model.on(<span class="string">'all'</span>, <span class="keyword">this</span>._onModelEvent, <span class="keyword">this</span>);
          <span class="keyword">this</span>._byId[model.cid] = model;
          <span class="keyword">if</span> (model.id != <span class="literal">null</span>) <span class="keyword">this</span>._byId[model.id] = model;
        }
        <span class="keyword">if</span> (order) order.push(existing || model);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>Remove nonexistent models if appropriate.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (remove) {
        <span class="keyword">for</span> (i = <span class="number">0</span>, l = <span class="keyword">this</span>.length; i &lt; l; ++i) {
          <span class="keyword">if</span> (!modelMap[(model = <span class="keyword">this</span>.models[i]).cid]) toRemove.push(model);
        }
        <span class="keyword">if</span> (toRemove.length) <span class="keyword">this</span>.remove(toRemove, options);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>See if sorting is needed, update <code>length</code> and splice in new models.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (toAdd.length || (order &amp;&amp; order.length)) {
        <span class="keyword">if</span> (sortable) sort = <span class="literal">true</span>;
        <span class="keyword">this</span>.length += toAdd.length;
        <span class="keyword">if</span> (at != <span class="literal">null</span>) {
          splice.apply(<span class="keyword">this</span>.models, [at, <span class="number">0</span>].concat(toAdd));
        } <span class="keyword">else</span> {
          <span class="keyword">if</span> (order) <span class="keyword">this</span>.models.length = <span class="number">0</span>;
          push.apply(<span class="keyword">this</span>.models, order || toAdd);
        }
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>Silently sort the collection if appropriate.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (sort) <span class="keyword">this</span>.sort({silent: <span class="literal">true</span>});

      <span class="keyword">if</span> (options.silent) <span class="keyword">return</span> <span class="keyword">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Trigger <code>add</code> events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">for</span> (i = <span class="number">0</span>, l = toAdd.length; i &lt; l; i++) {
        (model = toAdd[i]).trigger(<span class="string">'add'</span>, model, <span class="keyword">this</span>, options);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Trigger <code>sort</code> if the collection was sorted.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (sort || (order &amp;&amp; order.length)) <span class="keyword">this</span>.trigger(<span class="string">'sort'</span>, <span class="keyword">this</span>, options);
      <span class="keyword">return</span> <span class="keyword">this</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>When you have more items than you want to add or remove individually,
you can reset the entire set with a new list of models, without firing
any granular <code>add</code> or <code>remove</code> events. Fires <code>reset</code> when finished.
Useful for bulk operations and optimizations.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    reset: <span class="keyword">function</span>(models, options) {
      options || (options = {});
      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = <span class="keyword">this</span>.models.length; i &lt; l; i++) {
        <span class="keyword">this</span>._removeReference(<span class="keyword">this</span>.models[i]);
      }
      options.previousModels = <span class="keyword">this</span>.models;
      <span class="keyword">this</span>._reset();
      <span class="keyword">this</span>.add(models, _.extend({silent: <span class="literal">true</span>}, options));
      <span class="keyword">if</span> (!options.silent) <span class="keyword">this</span>.trigger(<span class="string">'reset'</span>, <span class="keyword">this</span>, options);
      <span class="keyword">return</span> <span class="keyword">this</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>Add a model to the end of the collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    push: <span class="keyword">function</span>(model, options) {
      model = <span class="keyword">this</span>._prepareModel(model, options);
      <span class="keyword">this</span>.add(model, _.extend({at: <span class="keyword">this</span>.length}, options));
      <span class="keyword">return</span> model;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>Remove a model from the end of the collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    pop: <span class="keyword">function</span>(options) {
      <span class="keyword">var</span> model = <span class="keyword">this</span>.at(<span class="keyword">this</span>.length - <span class="number">1</span>);
      <span class="keyword">this</span>.remove(model, options);
      <span class="keyword">return</span> model;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>Add a model to the beginning of the collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    unshift: <span class="keyword">function</span>(model, options) {
      model = <span class="keyword">this</span>._prepareModel(model, options);
      <span class="keyword">this</span>.add(model, _.extend({at: <span class="number">0</span>}, options));
      <span class="keyword">return</span> model;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>Remove a model from the beginning of the collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    shift: <span class="keyword">function</span>(options) {
      <span class="keyword">var</span> model = <span class="keyword">this</span>.at(<span class="number">0</span>);
      <span class="keyword">this</span>.remove(model, options);
      <span class="keyword">return</span> model;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>Slice out a sub-array of models from the collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    slice: <span class="keyword">function</span>() {
      <span class="keyword">return</span> slice.apply(<span class="keyword">this</span>.models, arguments);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>Get a model from the set by id.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    get: <span class="keyword">function</span>(obj) {
      <span class="keyword">if</span> (obj == <span class="literal">null</span>) <span class="keyword">return</span> <span class="keyword">void</span> <span class="number">0</span>;
      <span class="keyword">return</span> <span class="keyword">this</span>._byId[obj.id != <span class="literal">null</span> ? obj.id : obj.cid || obj];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>Get the model at the given index.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    at: <span class="keyword">function</span>(index) {
      <span class="keyword">return</span> <span class="keyword">this</span>.models[index];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>Return models with matching attributes. Useful for simple cases of
<code>filter</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    where: <span class="keyword">function</span>(attrs, first) {
      <span class="keyword">if</span> (_.isEmpty(attrs)) <span class="keyword">return</span> first ? <span class="keyword">void</span> <span class="number">0</span> : [];
      <span class="keyword">return</span> <span class="keyword">this</span>[first ? <span class="string">'find'</span> : <span class="string">'filter'</span>](<span class="keyword">function</span>(model) {
        <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> attrs) {
          <span class="keyword">if</span> (attrs[key] !== model.get(key)) <span class="keyword">return</span> <span class="literal">false</span>;
        }
        <span class="keyword">return</span> <span class="literal">true</span>;
      });
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>Return the first model with matching attributes. Useful for simple cases
of <code>find</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    findWhere: <span class="keyword">function</span>(attrs) {
      <span class="keyword">return</span> <span class="keyword">this</span>.where(attrs, <span class="literal">true</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>Force the collection to re-sort itself. You don&#39;t need to call this under
normal circumstances, as the set will maintain sort order as each item
is added.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    sort: <span class="keyword">function</span>(options) {
      <span class="keyword">if</span> (!<span class="keyword">this</span>.comparator) <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'Cannot sort a set without a comparator'</span>);
      options || (options = {});</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>Run sort based on type of <code>comparator</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (_.isString(<span class="keyword">this</span>.comparator) || <span class="keyword">this</span>.comparator.length === <span class="number">1</span>) {
        <span class="keyword">this</span>.models = <span class="keyword">this</span>.sortBy(<span class="keyword">this</span>.comparator, <span class="keyword">this</span>);
      } <span class="keyword">else</span> {
        <span class="keyword">this</span>.models.sort(_.bind(<span class="keyword">this</span>.comparator, <span class="keyword">this</span>));
      }

      <span class="keyword">if</span> (!options.silent) <span class="keyword">this</span>.trigger(<span class="string">'sort'</span>, <span class="keyword">this</span>, options);
      <span class="keyword">return</span> <span class="keyword">this</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>Figure out the smallest index at which a model should be inserted so as
to maintain order.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    sortedIndex: <span class="keyword">function</span>(model, value, context) {
      value || (value = <span class="keyword">this</span>.comparator);
      <span class="keyword">var</span> iterator = _.isFunction(value) ? value : <span class="keyword">function</span>(model) {
        <span class="keyword">return</span> model.get(value);
      };
      <span class="keyword">return</span> _.sortedIndex(<span class="keyword">this</span>.models, model, iterator, context);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>Pluck an attribute from each model in the collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    pluck: <span class="keyword">function</span>(attr) {
      <span class="keyword">return</span> _.invoke(<span class="keyword">this</span>.models, <span class="string">'get'</span>, attr);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>Create a new collection with an identical list of models as this one.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    clone: <span class="keyword">function</span>() {
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">this</span>.constructor(<span class="keyword">this</span>.models);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>Private method to reset all internal state. Called when the collection
is first initialized or reset.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _reset: <span class="keyword">function</span>() {
      <span class="keyword">this</span>.length = <span class="number">0</span>;
      <span class="keyword">this</span>.models = [];
      <span class="keyword">this</span>._byId  = {};
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>Prepare a hash of attributes (or other model) to be added to this
collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _prepareModel: <span class="keyword">function</span>(attrs, options) {
      <span class="keyword">if</span> (attrs <span class="keyword">instanceof</span> Model) {
        <span class="keyword">if</span> (!attrs.collection) attrs.collection = <span class="keyword">this</span>;
        <span class="keyword">return</span> attrs;
      }
      options || (options = {});
      options.collection = <span class="keyword">this</span>;
      <span class="keyword">var</span> model = <span class="keyword">new</span> <span class="keyword">this</span>.model(attrs, options);
      <span class="keyword">if</span> (!model._validate(attrs, options)) {
        <span class="keyword">this</span>.trigger(<span class="string">'invalid'</span>, <span class="keyword">this</span>, attrs, options);
        <span class="keyword">return</span> <span class="literal">false</span>;
      }
      <span class="keyword">return</span> model;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>Internal method to sever a model&#39;s ties to a collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _removeReference: <span class="keyword">function</span>(model) {
      <span class="keyword">if</span> (<span class="keyword">this</span> === model.collection) <span class="keyword">delete</span> model.collection;
      model.off(<span class="string">'all'</span>, <span class="keyword">this</span>._onModelEvent, <span class="keyword">this</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>Internal method called every time a model in the set fires an event.
Sets need to update their indexes when models change ids. All other
events simply proxy through. &quot;add&quot; and &quot;remove&quot; events that originate
in other collections are ignored.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _onModelEvent: <span class="keyword">function</span>(event, model, collection, options) {
      <span class="keyword">if</span> ((event === <span class="string">'add'</span> || event === <span class="string">'remove'</span>) &amp;&amp; collection !== <span class="keyword">this</span>) <span class="keyword">return</span>;
      <span class="keyword">if</span> (event === <span class="string">'destroy'</span>) <span class="keyword">this</span>.remove(model, options);
      <span class="keyword">if</span> (model &amp;&amp; event === <span class="string">'change:'</span> + model.idAttribute) {
        <span class="keyword">delete</span> <span class="keyword">this</span>._byId[model.previous(model.idAttribute)];
        <span class="keyword">if</span> (model.id != <span class="literal">null</span>) <span class="keyword">this</span>._byId[model.id] = model;
      }
      <span class="keyword">this</span>.trigger.apply(<span class="keyword">this</span>, arguments);
    }

  });</pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>Underscore methods that we want to implement on the Collection.
90% of the core usefulness of Backbone Collections is actually implemented
right here:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> methods = [<span class="string">'forEach'</span>, <span class="string">'each'</span>, <span class="string">'map'</span>, <span class="string">'collect'</span>, <span class="string">'reduce'</span>, <span class="string">'foldl'</span>,
    <span class="string">'inject'</span>, <span class="string">'reduceRight'</span>, <span class="string">'foldr'</span>, <span class="string">'find'</span>, <span class="string">'detect'</span>, <span class="string">'filter'</span>, <span class="string">'select'</span>,
    <span class="string">'reject'</span>, <span class="string">'every'</span>, <span class="string">'all'</span>, <span class="string">'some'</span>, <span class="string">'any'</span>, <span class="string">'include'</span>, <span class="string">'contains'</span>, <span class="string">'invoke'</span>,
    <span class="string">'max'</span>, <span class="string">'min'</span>, <span class="string">'toArray'</span>, <span class="string">'size'</span>, <span class="string">'first'</span>, <span class="string">'head'</span>, <span class="string">'take'</span>, <span class="string">'initial'</span>, <span class="string">'rest'</span>,
    <span class="string">'tail'</span>, <span class="string">'drop'</span>, <span class="string">'last'</span>, <span class="string">'without'</span>, <span class="string">'indexOf'</span>, <span class="string">'shuffle'</span>, <span class="string">'lastIndexOf'</span>,
    <span class="string">'isEmpty'</span>, <span class="string">'chain'</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>Mix in each Underscore method as a proxy to <code>Collection#models</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.each(methods, <span class="keyword">function</span>(method) {
    Collection.prototype[method] = <span class="keyword">function</span>() {
      <span class="keyword">var</span> args = slice.call(arguments);
      args.unshift(<span class="keyword">this</span>.models);
      <span class="keyword">return</span> _[method].apply(_, args);
    };
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>Underscore methods that take a property name as an argument.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> attributeMethods = [<span class="string">'groupBy'</span>, <span class="string">'countBy'</span>, <span class="string">'sortBy'</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <p>Use attributes instead of properties.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.each(attributeMethods, <span class="keyword">function</span>(method) {
    Collection.prototype[method] = <span class="keyword">function</span>(value, context) {
      <span class="keyword">var</span> iterator = _.isFunction(value) ? value : <span class="keyword">function</span>(model) {
        <span class="keyword">return</span> model.get(value);
      };
      <span class="keyword">return</span> _[method](<span class="keyword">this</span>.models, iterator, context);
    };
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <h2>Backbone.View</h2>

            </div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p>TODO: rewrite this, when the dust settles, as this is all wrong now
Backbone Views are almost more convention than they are actual code. A View
is simply a JavaScript object that represents a logical chunk of UI in the
DOM. This might be a single item, an entire list, a sidebar or panel, or
even the surrounding frame which wraps your whole app. Defining a chunk of
UI as a <strong>View</strong> allows you to define your DOM events declaratively, without
having to worry about render order ... and makes it easy for the view to
react to specific changes in the state of your models.</p>
<p>Creating a Backbone.View creates its initial element outside of the DOM,
if an existing element is not provided...</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> View = Backbone.View = <span class="keyword">function</span>(options) {
    <span class="keyword">this</span>.cid = _.uniqueId(<span class="string">'view'</span>);
    <span class="keyword">this</span>._configure(options || {});
    <span class="keyword">this</span>._ensureElement();
    <span class="keyword">this</span>.children = [];
    <span class="keyword">this</span>.initialize.apply(<span class="keyword">this</span>, arguments);
    <span class="keyword">this</span>.inputFocus = <span class="literal">null</span>;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>List of view options to be merged as properties.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> viewOptions = [<span class="string">'model'</span>, <span class="string">'collection'</span>, <span class="string">'el'</span>, <span class="string">'id'</span>, <span class="string">'attributes'</span>, <span class="string">'className'</span>, <span class="string">'tagName'</span>, <span class="string">'events'</span>, <span class="string">'containerSelector'</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>Set up all inheritable <strong>Backbone.View</strong> properties and methods.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.extend(View.prototype, Events, {</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <p>The default <code>tagName</code> of a View&#39;s element is <code>&quot;div&quot;</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    tagName: <span class="string">'div'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <p>The default &#39;childContainer&#39; is null which tells the
view to add the children directly to &#39;el&#39;. The container
must start without any children</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    containerSelector: <span class="literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <p>Gets the &#39;childContainer&#39;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getChildContainer: <span class="keyword">function</span>() {
      <span class="keyword">return</span> <span class="keyword">this</span>.containerSelector
                    ? <span class="keyword">this</span>.$(<span class="keyword">this</span>.containerSelector).first()
                    : <span class="keyword">this</span>.$el;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>Will empty the &#39;childContainer&#39; and then add all children
back in. Should be used when you need to re-render, or any
other time the &#39;childContainer&#39; may be holding invalid
elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    syncChildren: <span class="keyword">function</span>() {
      <span class="keyword">var</span> container = <span class="keyword">this</span>.getChildContainer();
      container.empty();
      <span class="keyword">for</span> (<span class="keyword">var</span> idx = <span class="number">0</span>; idx &lt; <span class="keyword">this</span>.children.length; ++idx) {
        container.append(<span class="keyword">this</span>.children[idx].el);
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <p>Add a child to this View</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    addChild: <span class="keyword">function</span>(child) {
      <span class="keyword">this</span>.children.push(child);
      <span class="keyword">this</span>.getChildContainer().append(child.el);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <p>Add a child to this View at index</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    addChildAt: <span class="keyword">function</span>(child, idx) {
      <span class="keyword">this</span>.children.splice(idx, <span class="number">0</span>, child);
      <span class="keyword">var</span> container = <span class="keyword">this</span>.getChildContainer();
      <span class="keyword">var</span> children = container.children();
      <span class="keyword">if</span> (children.length &lt;= idx) container.append(child.el);
      <span class="keyword">else</span>                        child.$el.insertBefore(children.eq(idx));
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <p>Get child at</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getChildAt: <span class="keyword">function</span>(idx) {
      <span class="keyword">return</span> <span class="keyword">this</span>.children[idx];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <p>Get child index</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getChildIndex: <span class="keyword">function</span>(child) {
      <span class="keyword">return</span> <span class="keyword">this</span>.children.indexOf(child);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <p>Get children</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getChildren: <span class="keyword">function</span>() {
      <span class="keyword">return</span> <span class="keyword">this</span>.children.slice(<span class="number">0</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <p>Remove Child</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    removeChild: <span class="keyword">function</span>(child) {
      <span class="keyword">var</span> childIDX = <span class="keyword">this</span>.children.indexOf(child);
      <span class="keyword">if</span> (childIDX !== -<span class="number">1</span>) {
        <span class="keyword">this</span>.children.splice(childIDX, <span class="number">1</span>);
        child.$el.remove();
      }
      <span class="keyword">if</span> (<span class="keyword">this</span>.getFocus() == child) {
          <span class="keyword">this</span>.setFocus(<span class="literal">null</span>);
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <p>Get the next child in the focus chain</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getFocus: <span class="keyword">function</span>() {
      <span class="keyword">return</span> <span class="keyword">this</span>.inputFocus;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p>Set which child has focus</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    setFocus: <span class="keyword">function</span>(child) {
      <span class="keyword">if</span> (child == <span class="literal">null</span>) {
        <span class="keyword">this</span>.inputFocus = <span class="literal">null</span>;
        <span class="keyword">return</span> <span class="literal">true</span>;
      }
      <span class="keyword">var</span> idx = <span class="keyword">this</span>.getChildIndex(child);
      <span class="keyword">if</span> (idx != -<span class="number">1</span>) {
        <span class="keyword">this</span>.inputFocus = child;
        <span class="keyword">return</span> <span class="literal">true</span>;
      }
      <span class="keyword">return</span> <span class="literal">false</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>Call back for the InputHandler, returning &#39;true&#39; notifies the Input
Handler that the event is being &#39;captured&#39; by this View and that it
should stop searching for the focus element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    captureKeyDown: <span class="keyword">function</span>(event) {
      <span class="keyword">return</span> <span class="literal">false</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>Call back for the InputHandler, returning &#39;true&#39; notifies the Input
Handler that the event has been handled and not to pass it up the 
View Tree</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    onKeyDown: <span class="keyword">function</span>(event) {
      <span class="keyword">return</span> <span class="literal">false</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>jQuery delegate for element lookup, scoped to DOM elements within the
current view. This should be prefered to global lookups where possible.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $: <span class="keyword">function</span>(selector) {
      <span class="keyword">return</span> <span class="keyword">this</span>.$el.find(selector);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <p>Initialize is an empty function by default. Override it with your own
initialization logic.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    initialize: <span class="keyword">function</span>(){},</pre></div></div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              <p><strong>render</strong> is the core function that your view should override, in order
to populate its element (<code>this.el</code>), with the appropriate HTML. The
convention is for <strong>render</strong> to always return <code>this</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    render: <span class="keyword">function</span>() {
      <span class="keyword">return</span> <span class="keyword">this</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <p>Remove this view by taking the element out of the DOM, and removing any
applicable Backbone.Events listeners.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    remove: <span class="keyword">function</span>() {
      <span class="keyword">this</span>.$el.remove();
      <span class="keyword">this</span>.stopListening();
      <span class="keyword">return</span> <span class="keyword">this</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <p>Change the view&#39;s element (<code>this.el</code> property)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    setElement: <span class="keyword">function</span>(element) {
      <span class="keyword">this</span>.$el = element <span class="keyword">instanceof</span> Backbone.$ ? element : Backbone.$(element);
      <span class="keyword">this</span>.el = <span class="keyword">this</span>.$el[<span class="number">0</span>];
      <span class="keyword">return</span> <span class="keyword">this</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <p>Performs the initial configuration of a View with a set of options.
Keys with special meaning <em>(e.g. model, collection, id, className)</em> are
attached directly to the view.  See <code>viewOptions</code> for an exhaustive
list.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _configure: <span class="keyword">function</span>(options) {
      <span class="keyword">if</span> (<span class="keyword">this</span>.options) options = _.extend({}, _.result(<span class="keyword">this</span>, <span class="string">'options'</span>), options);
      _.extend(<span class="keyword">this</span>, _.pick(options, viewOptions));
      <span class="keyword">this</span>.options = options;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-125">&#182;</a>
              </div>
              <p>Ensure that the View has a DOM element to render into.
If <code>this.el</code> is a string, pass it through <code>$()</code>, take the first
matching element, and re-assign it to <code>el</code>. Otherwise, create
an element from the <code>id</code>, <code>className</code> and <code>tagName</code> properties.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _ensureElement: <span class="keyword">function</span>() {
      <span class="keyword">if</span> (!<span class="keyword">this</span>.el) {
        <span class="keyword">var</span> attrs = _.extend({}, _.result(<span class="keyword">this</span>, <span class="string">'attributes'</span>));
        <span class="keyword">if</span> (<span class="keyword">this</span>.id) attrs.id = _.result(<span class="keyword">this</span>, <span class="string">'id'</span>);
        <span class="keyword">if</span> (<span class="keyword">this</span>.className) attrs[<span class="string">'class'</span>] = _.result(<span class="keyword">this</span>, <span class="string">'className'</span>);
        <span class="keyword">var</span> $el = Backbone.$(<span class="string">'&lt;'</span> + _.result(<span class="keyword">this</span>, <span class="string">'tagName'</span>) + <span class="string">'&gt;'</span>).attr(attrs);
        <span class="keyword">this</span>.setElement($el, <span class="literal">false</span>);
      } <span class="keyword">else</span> {
        <span class="keyword">this</span>.setElement(_.result(<span class="keyword">this</span>, <span class="string">'el'</span>), <span class="literal">false</span>);
      }
    }

  });</pre></div></div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-126">&#182;</a>
              </div>
              <h2>Backbone.InputHandler</h2>

            </div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-127">&#182;</a>
              </div>
              <p>Backbone InputHandlers are used to pass non pointer events up the View 
Tree to the current focused element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> InputHandler = Backbone.InputHandler = <span class="keyword">function</span>(rootEle, rootView) {
    <span class="keyword">this</span>.rootEle = rootEle;
    <span class="keyword">this</span>.rootView = rootView;
    <span class="keyword">this</span>.initialize();
  };

  _.extend(InputHandler.prototype, {</pre></div></div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-128">&#182;</a>
              </div>
              <p>A mapping of dom events to view callback functions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    eventTypes: [
      {
        <span class="string">'name'</span>: <span class="string">'keydown'</span>,
        <span class="string">'capture'</span>: <span class="string">'captureKeyDown'</span>,
        <span class="string">'event'</span>: <span class="string">'onKeyDown'</span>
      },
      {
        <span class="string">'name'</span>: <span class="string">'keyup'</span>,
        <span class="string">'capture'</span>: <span class="string">'captureKeyUp'</span>,
        <span class="string">'event'</span>: <span class="string">'onKeyUp'</span>
      }
    ],</pre></div></div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-129">&#182;</a>
              </div>
              <p>Sets up a callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    initializeEvent: <span class="keyword">function</span>(eventType) {
      <span class="keyword">var</span> self = <span class="keyword">this</span>;
      <span class="keyword">var</span> makeCallback = <span class="keyword">function</span>(eventType) {
        <span class="keyword">return</span> <span class="keyword">function</span>(event) {
          self.walkViews(eventType.capture, eventType.event, event);
        }
      }
      <span class="keyword">this</span>.rootEle.addEventListener(eventType.name, makeCallback(eventType));
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-130">&#182;</a>
              </div>
              <p>Sets up initial events from eventMap</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    initialize: <span class="keyword">function</span>() {
      <span class="keyword">for</span> (<span class="keyword">var</span> idx = <span class="number">0</span>; idx &lt; <span class="keyword">this</span>.eventTypes.length; ++idx) {
        <span class="keyword">this</span>.initializeEvent(<span class="keyword">this</span>.eventTypes[idx]);
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-131">&#182;</a>
              </div>
              <p>Walk a focus path through a view-tree calling the 
appropriate callbacks</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    walkViews: <span class="keyword">function</span>(capture, onEvent, event) {
      <span class="keyword">var</span> viewStack = [];
      <span class="keyword">var</span> cur = <span class="keyword">this</span>.rootView;

      <span class="keyword">do</span> {
        viewStack.push(cur);
        <span class="keyword">var</span> captured = <span class="literal">false</span>;
        <span class="keyword">if</span> (capture <span class="keyword">in</span> cur) {
          captured = cur[capture](event);
        }
        <span class="keyword">if</span> (captured) {
          <span class="keyword">break</span>;
        }
        cur = cur.getFocus();
      } <span class="keyword">while</span> (cur);

      <span class="keyword">while</span> (viewStack.length) {
        cur = viewStack.pop();
        <span class="keyword">var</span> handled = <span class="literal">false</span>;
        <span class="keyword">if</span> (onEvent <span class="keyword">in</span> cur) {
          handled = cur[onEvent](event);
        }
        <span class="keyword">if</span> (handled) {
          <span class="keyword">break</span>;
        }
      }
    }
    
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-132">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-132">&#182;</a>
              </div>
              <h2>Helpers</h2>

            </div>
            
        </li>
        
        
        <li id="section-133">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-133">&#182;</a>
              </div>
              <p>Helper function to correctly set up the prototype chain, for subclasses.
Similar to <code>goog.inherits</code>, but uses a hash of prototype properties and
class properties to be extended.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> extend = <span class="keyword">function</span>(protoProps, staticProps) {
    <span class="keyword">var</span> parent = <span class="keyword">this</span>;
    <span class="keyword">var</span> child;</pre></div></div>
            
        </li>
        
        
        <li id="section-134">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-134">&#182;</a>
              </div>
              <p>The constructor function for the new subclass is either defined by you
(the &quot;constructor&quot; property in your <code>extend</code> definition), or defaulted
by us to simply call the parent&#39;s constructor.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (protoProps &amp;&amp; _.has(protoProps, <span class="string">'constructor'</span>)) {
      child = protoProps.constructor;
    } <span class="keyword">else</span> {
      child = <span class="keyword">function</span>(){ <span class="keyword">return</span> parent.apply(<span class="keyword">this</span>, arguments); };
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-135">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-135">&#182;</a>
              </div>
              <p>Add static properties to the constructor function, if supplied.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.extend(child, parent, staticProps);</pre></div></div>
            
        </li>
        
        
        <li id="section-136">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-136">&#182;</a>
              </div>
              <p>Set the prototype chain to inherit from <code>parent</code>, without calling
<code>parent</code>&#39;s constructor function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">var</span> Surrogate = <span class="keyword">function</span>(){ <span class="keyword">this</span>.constructor = child; };
    Surrogate.prototype = parent.prototype;
    child.prototype = <span class="keyword">new</span> Surrogate;</pre></div></div>
            
        </li>
        
        
        <li id="section-137">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-137">&#182;</a>
              </div>
              <p>Add prototype properties (instance properties) to the subclass,
if supplied.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (protoProps) _.extend(child.prototype, protoProps);</pre></div></div>
            
        </li>
        
        
        <li id="section-138">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-138">&#182;</a>
              </div>
              <p>Set a convenience property in case the parent&#39;s prototype is needed
later.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    child.__super__ = parent.prototype;

    <span class="keyword">return</span> child;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-139">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-139">&#182;</a>
              </div>
              <p>Set up inheritance for the model, collection, router, view and history.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Model.extend = Collection.extend = View.extend = InputHandler.extend = extend;</pre></div></div>
            
        </li>
        
        
        <li id="section-140">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-140">&#182;</a>
              </div>
              <p>Throw an error when a URL is needed, and none is supplied.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> urlError = <span class="keyword">function</span>() {
    <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'A "url" property or function must be specified'</span>);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-141">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-141">&#182;</a>
              </div>
              <p>Wrap an optional error callback with a fallback error event.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> wrapError = <span class="keyword">function</span>(model, options) {
    <span class="keyword">var</span> error = options.error;
    options.error = <span class="keyword">function</span>(resp) {
      <span class="keyword">if</span> (error) error(model, resp, options);
      model.trigger(<span class="string">'error'</span>, model, resp, options);
    };
  };

}).call(<span class="keyword">this</span>);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
